---
layout: pgm-into-new_md
title: 使元素居中的三种方法
id: pgm-26
url: programme/26
css: <link rel="stylesheet" type="text/css" href="../programme/pgm-page25/pgm-page26.css">
permalink: /programme/26
---
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="ktiz" id="react复制功能组件实现">[react]复制功能组件实现</h1><hr><p data-anchor-id="65zp"><code>JavaScript</code> <code>React</code> <code>copy</code> <code>component</code>  <br>
站内信目前有个需求，设计了一种可后台配置带复制功能的消息格式</p><p>
	<img src="../programme/pgm-page26/imgs/show1.jpg" height="326" width="429" alt="样式展示">
</p><p data-anchor-id="xh84">当用户点击复制按钮，将会把左边的对应的兑换码或卡密复制到剪切版中</p><ul data-anchor-id="uiq8">
<li><p>思路</p>

<ul><li>由于<code>textObject.select()</code>方法和目前尚未普及的<code>selectionDirection</code>方法(不支持<code>IE</code>)仅支持取<code>type</code>为<code>text</code>, <code>search</code>, <code>URL</code>, <code>tel</code> and <code>password</code>的<code>input</code>元素的值,其它元素无法实现复制功能，这种模式显然不适合需求实现，此插件就是为解决此问题而设计。</li>
<li>当用户初次激活使用复制功能时，在页面中创建一个<code>input</code>标签，由于复制功能是该标签要获得焦点，所以该标签样式属性要满足一下几点 <br>
<ul><li>该标签的<strong>display</strong>不能为 <strong>none</strong></li>
<li>该标签的<strong>visibility</strong>属性不能为 <strong>hidden</strong></li>
<li>在<strong>chrome</strong>浏览器中 该标签的 <strong>width</strong> 不能为 <strong>0</strong>，否则chrome会默认选中的文本为空</li>
<li>在<strong>搜狗浏览器</strong>中 该标签的  <strong>width</strong> 和 <strong>height</strong> 都不能为 <strong>0</strong>，否则浏览器会默认选中文本为空</li></ul></li></ul></li>
<li><p>浏览器支持：兼容 <strong>IE9+</strong>及其它高级浏览器</p></li>
<li><p>HTML代码结构：</p></li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="g7yu" style=""><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="pln">    </span><span class="com">//引用</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">    </span><span class="kwd">import</span><span class="pln"> </span><span class="pun">{</span><span class="typ">IELessThanVer</span><span class="pun">}</span><span class="pln"> from </span><span class="str">'constants/constants'</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">    </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Replication</span><span class="pln"> from </span><span class="str">'lib/replication/Replication'</span></code></li><li class="L3"><code class="language-javascript"></code></li><li class="L4"><code class="language-javascript"><span class="pln">    dyField</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">,</span><span class="pln">index</span><span class="pun">){</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">        cont</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">            </span><span class="pun">&lt;</span><span class="pln">dl key</span><span class="pun">={</span><span class="pln">index</span><span class="pun">}&gt;</span><span class="pln"> </span><span class="com">// react涉及到的循环中，每个子对象都应该有对应的key值，否则浏览器会报 Each child in an array or iterator should have a unique "key" prop.</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">                </span><span class="pun">&lt;</span><span class="pln">dt</span><span class="pun">&gt;{</span><span class="pln">elem</span><span class="pun">.</span><span class="typ">Key</span><span class="pun">}：&lt;/</span><span class="pln">dt</span><span class="pun">&gt;</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">                </span><span class="pun">&lt;</span><span class="pln">dd</span><span class="pun">&gt;{</span><span class="pln">elem</span><span class="pun">.</span><span class="typ">Val</span><span class="pun">}&lt;/</span><span class="pln">dd</span><span class="pun">&gt;</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">                </span><span class="pun">{!</span><span class="typ">IELessThanVer</span><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> elem</span><span class="pun">.</span><span class="typ">Copy</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">elem</span><span class="pun">.</span><span class="typ">Copy</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">                </span><span class="pun">&lt;</span><span class="pln">dd className</span><span class="pun">=</span><span class="str">"copy"</span><span class="pln"> onClick </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{()=&gt;</span><span class="typ">Replication</span><span class="pun">({</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">                    value </span><span class="pun">:</span><span class="pln"> elem</span><span class="pun">.</span><span class="typ">Val</span><span class="pun">,</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">                    fail</span><span class="pun">(){</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">                       </span><span class="typ">Toast</span><span class="pun">.</span><span class="pln">notice</span><span class="pun">(</span><span class="str">"复制失败，请手动复制"</span><span class="pun">);</span><span class="pln"> </span></code></li><li class="L4"><code class="language-javascript"><span class="pln">                    </span><span class="pun">}</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">                </span><span class="pun">})}&gt;复制&lt;/</span><span class="pln">dd</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">:</span><span class="str">""</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">                </span><span class="pun">}</span><span class="pln"> 　　</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">            </span><span class="pun">&lt;/</span><span class="pln">dl</span><span class="pun">&gt;</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">        </span><span class="pun">)</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">    </span><span class="pun">})</span><span class="pln"> </span></code></li><li class="L0"><code class="language-javascript"></code></li><li class="L1"><code class="language-javascript"><span class="pln">    </span><span class="com">/*************dyField数据格式*****************/</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">    dyField </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">            </span><span class="typ">Copy</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">            </span><span class="typ">Key</span><span class="pun">:</span><span class="str">"兑换码"</span><span class="pun">,</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">            </span><span class="typ">Val</span><span class="pun">:</span><span class="str">"12345XADdddd"</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">        </span><span class="pun">},</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">            </span><span class="typ">Copy</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">            </span><span class="typ">Key</span><span class="pun">:</span><span class="str">"卡密"</span><span class="pun">,</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">            </span><span class="typ">Val</span><span class="pun">:</span><span class="str">"12345XAD"</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">        </span><span class="pun">},</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">            </span><span class="typ">Copy</span><span class="pun">:</span><span class="lit">0</span><span class="pun">,</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">            </span><span class="typ">Key</span><span class="pun">:</span><span class="str">"有效期"</span><span class="pun">,</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">            </span><span class="typ">Val</span><span class="pun">:</span><span class="str">"2017.12.23 23:59之前"</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">    </span><span class="pun">]</span></code></li></ol></pre><ul data-anchor-id="thko">
<li>具体实现：</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="r3n3" style=""><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="com">/**</span></code></li><li class="L1"><code class="language-javascript"><span class="com"> * des : copy method of react</span></code></li><li class="L2"><code class="language-javascript"><span class="com"> * Browser compatibility: IE9+</span></code></li><li class="L3"><code class="language-javascript"><span class="com"> * @param  {[obj]} externalConfig</span></code></li><li class="L4"><code class="language-javascript"><span class="com"> *     value        [The value to copy]</span></code></li><li class="L5"><code class="language-javascript"><span class="com"> *     cutOutLength [The length of the intercept(default:check all)] -Optional  </span></code></li><li class="L6"><code class="language-javascript"><span class="com"> *     fail         [Failed execution function] -Optional  </span></code></li><li class="L7"><code class="language-javascript"><span class="com"> * @return {[undefined]}    undefined</span></code></li><li class="L8"><code class="language-javascript"><span class="com"> */</span></code></li><li class="L9"><code class="language-javascript"><span class="kwd">export</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">externalConfig</span><span class="pun">){</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">    let currentFocus </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">activeElement</span><span class="pun">;</span></code></li><li class="L1"><code class="language-javascript"></code></li><li class="L2"><code class="language-javascript"><span class="pln">    let fictitiousInput </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">'fictitiousInput'</span><span class="pun">);</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">    let defaultConfig </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">        cutOutLength </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">    </span><span class="pun">};</span></code></li><li class="L6"><code class="language-javascript"></code></li><li class="L7"><code class="language-javascript"><span class="pln">    let config </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{...</span><span class="pln">defaultConfig</span><span class="pun">,...</span><span class="pln">externalConfig</span><span class="pun">};</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">    config</span><span class="pun">.</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">(...</span><span class="pln">config</span><span class="pun">.</span><span class="pln">cutOutLength</span><span class="pun">);</span></code></li><li class="L9"><code class="language-javascript"></code></li><li class="L0"><code class="language-javascript"><span class="pln">    </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">fictitiousInput</span><span class="pun">){</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">        fictitiousInput </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'input'</span><span class="pun">);</span></code></li><li class="L2"><code class="language-javascript"></code></li><li class="L3"><code class="language-javascript"><span class="pln">        let attrConfig </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">            type</span><span class="pun">:</span><span class="str">"text"</span><span class="pun">,</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">            value</span><span class="pun">:</span><span class="pln">config</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="pln"> </span></code></li><li class="L6"><code class="language-javascript"><span class="pln">            id</span><span class="pun">:</span><span class="str">"fictitiousInput"</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">        </span><span class="pun">};</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">        let styleConfig </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">            padding</span><span class="pun">:</span><span class="lit">0</span><span class="pun">,</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">            border</span><span class="pun">:</span><span class="str">"none"</span><span class="pun">,</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">            margin</span><span class="pun">:</span><span class="lit">0</span><span class="pun">,</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">            position</span><span class="pun">:</span><span class="str">"fixed"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">            zIndex</span><span class="pun">:-</span><span class="lit">1</span><span class="pun">,</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">        </span><span class="pun">};</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">        </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">keys</span><span class="pun">(</span><span class="pln">styleConfig</span><span class="pun">).</span><span class="pln">map</span><span class="pun">(</span><span class="pln"> elem </span><span class="pun">=&gt;</span><span class="pln"> fictitiousInput</span><span class="pun">.</span><span class="pln">style</span><span class="pun">[</span><span class="pln">elem</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> styleConfig</span><span class="pun">[</span><span class="pln">elem</span><span class="pun">]);</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">        </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">keys</span><span class="pun">(</span><span class="pln">attrConfig</span><span class="pun">).</span><span class="pln">map</span><span class="pun">(</span><span class="pln"> elem </span><span class="pun">=&gt;</span><span class="pln"> fictitiousInput</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">,</span><span class="pln">attrConfig</span><span class="pun">[</span><span class="pln">elem</span><span class="pun">]));</span></code></li><li class="L7"><code class="language-javascript"></code></li><li class="L8"><code class="language-javascript"><span class="pln">        document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">fictitiousInput</span><span class="pun">);</span><span class="pln">    </span></code></li><li class="L9"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">        fictitiousInput</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'value'</span><span class="pun">,</span><span class="pln">config</span><span class="pun">.</span><span class="pln">value</span><span class="pun">);</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L2"><code class="language-javascript"></code></li><li class="L3"><code class="language-javascript"><span class="pln">    fictitiousInput</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">    fictitiousInput</span><span class="pun">.</span><span class="pln">select</span><span class="pun">();</span><span class="pln"> </span></code></li><li class="L5"><code class="language-javascript"></code></li><li class="L6"><code class="language-javascript"><span class="pln">    </span><span class="kwd">try</span><span class="pun">{</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">document</span><span class="pun">.</span><span class="pln">execCommand</span><span class="pun">(</span><span class="str">'copy'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)){</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">            document</span><span class="pun">.</span><span class="pln">execCommand</span><span class="pun">(</span><span class="str">"Copy"</span><span class="pun">);</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">        </span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">            config</span><span class="pun">.</span><span class="pln">fail</span><span class="pun">&amp;&amp;</span><span class="pln">config</span><span class="pun">.</span><span class="pln">fail</span><span class="pun">();</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">        </span><span class="pun">};</span><span class="pln">     </span></code></li><li class="L2"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">err</span><span class="pun">){</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">        config</span><span class="pun">.</span><span class="pln">fail</span><span class="pun">&amp;&amp;</span><span class="pln">config</span><span class="pun">.</span><span class="pln">fail</span><span class="pun">();</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class="language-javascript"></code></li><li class="L6"><code class="language-javascript"><span class="pln">    currentFocus</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L7"><code class="language-javascript"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="fnb4"><strong>[注意]</strong></p><ul data-anchor-id="jst0">
<li>由于<code>setSelectionRange</code>方法不被IE所支持，遂使用字符串<code>slice</code>方法截取<code>value</code>值的方法代替实现对要复制字符串的截取</li>
<li>关于IE版本检测<code>IELessThanVer</code>方法实现如下：</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="b59v" style=""><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="kwd">export</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="typ">IELessThanVer</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="typ">Ver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">    let browser </span><span class="pun">=</span><span class="pln"> navigator</span><span class="pun">.</span><span class="pln">appName</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">    let b_version </span><span class="pun">=</span><span class="pln"> navigator</span><span class="pun">.</span><span class="pln">appVersion</span></code></li><li class="L3"><code class="language-javascript"></code></li><li class="L4"><code class="language-javascript"><span class="pln">    let version </span><span class="pun">=</span><span class="pln"> b_version</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">";"</span><span class="pun">);</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">    version</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="str">"prevent_firefox_console.show_error"</span><span class="pun">);</span></code></li><li class="L6"><code class="language-javascript"></code></li><li class="L7"><code class="language-javascript"><span class="pln">    let trim_Version </span><span class="pun">=</span><span class="pln"> version</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="pln">replace</span><span class="pun">(</span><span class="str">/[ ]/</span><span class="pln">g</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">);</span></code></li><li class="L8"><code class="language-javascript"></code></li><li class="L9"><code class="language-javascript"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">(</span><span class="pln">trim_Version</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">(</span><span class="lit">4</span><span class="pun">))</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="typ">Ver</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> browser </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Microsoft Internet Explorer"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code class="language-javascript"><span class="pun">}</span></code></li></ol></pre>

</div>